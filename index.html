<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Cutu!</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Load a cute, rounded, "poppy" font (Baloo 2) --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Updated font to Baloo 2 - it's much cuter and poppier! --><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* Apply the new cute font */
        body {
            /* Changed font-family to Baloo 2 */
            font-family: 'Baloo 2', sans-serif;
        }
        /* Custom styles for the app */
        .hello-kitty-card {
            /* Softer, prettier shadow */
            box-shadow: 0 10px 30px rgba(236, 72, 153, 0.15), 0 5px 15px rgba(236, 72, 153, 0.1);
        }
        /* Hide the default file input */
        input[type="file"] {
            display: none;
        }
        /* Custom scrollbar for a cuter feel */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #fdf2f8; /* pink-50 */
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #f472b6; /* pink-400 */
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #ec4899; /* pink-500 */
        }
    </style>
</head>
<!-- Added a nice gradient background --><body class="bg-gradient-to-br from-pink-100 to-rose-200 min-h-screen flex items-center justify-center p-4">

    <!-- Main Application Card --><!-- Made padding responsive --><div class="bg-white w-full max-w-md p-6 sm:p-8 rounded-2xl hello-kitty-card space-y-6">
        
        <!-- Header - All text updated as requested --><div class="text-center">
            <!-- Changed to a pink ghost emoji with features --><h1 class="text-4xl sm:text-5xl font-extrabold pb-1">
                <!-- Kept gradient on the text -->
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-rose-500">
                    Happy 17th Cutu!!!
                </span>
                                <!-- Made ghost a separate span and colored it pink -->
                <span class="text-pink-500">ðŸ‘»</span>
            </h1>
            <!-- Changed this line to a shade of pink --><h2 class="text-xl font-bold text-pink-600 mt-2">Ye le meri Hello Kitty Paglu hehe</h2>
            <p class="text-gray-500 mt-1">Hello Kitty ko kia kiya karte dekhna chahti hai re</p>
        </div>

        <!-- Prompt Input - Text updated --><div class="space-y-2">
            <label for="prompt" class="text-sm font-bold text-pink-600">Ithe likh:</label>
            <textarea id="prompt" rows="3" class="w-full p-3 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 transition-all" placeholder="jaise ke, &quot;eating yum food&quot; "></textarea>
        </div>

        <!-- Generate Button - Text and style updated --><button id="generate-btn" class="w-full bg-gradient-to-r from-pink-500 to-rose-500 text-white font-bold py-3 px-4 rounded-lg hover:from-pink-600 hover:to-rose-600 active:from-pink-700 active:to-rose-700 transition-all transform hover:scale-105 active:scale-100 flex items-center justify-center space-x-2 disabled:bg-pink-300 disabled:from-pink-300 disabled:to-pink-300 disabled:cursor-not-allowed">
            <!-- Loading Spinner (hidden by default) --><svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Bibidi Babidi Boo!</span>
        </button>

        <!-- Error Message Box --><div id="error-box" class="hidden p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm">
            <!-- Error messages will appear here --></div>

        <!-- Image Display Area - Placeholder text updated --><div class="w-full aspect-square bg-pink-50 rounded-lg border-2 border-dashed border-pink-200 flex items-center justify-center overflow-hidden">
            <!-- Updated placeholder font to Baloo 2 --><img id="sticker-image" src="https://placehold.co/512x512/fdf2f8/ec4899?text=Sticker+idher+vekhna+hehe&font=baloo-2" alt="Generated Hello Kitty Sticker" class="w-full h-full object-cover">
        </div>

        <!-- Download Button (hidden by default) --><a id="download-btn" class="hidden w-full bg-white text-pink-500 border-2 border-pink-500 font-bold py-3 px-4 rounded-lg hover:bg-pink-50 active:bg-pink-100 transition-all transform hover:scale-105 active:scale-100 flex items-center justify-center space-x-2 text-center" href="#" download="hello-kitty-sticker.png">
            <!-- Download Icon --><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            <span>Download Sticker</span>
        </a>

    </div>

    <script>
        // Get references to all the HTML elements we need
        const promptInput = document.getElementById('prompt');
        const generateBtn = document.getElementById('generate-btn');
        const loadingSpinner = document.getElementById('loading-spinner');
        const stickerImage = document.getElementById('sticker-image');
        const errorBox = document.getElementById('error-box');
        const generateBtnText = generateBtn.querySelector('span');
        const downloadBtn = document.getElementById('download-btn'); 
        
        // API Configuration
        const apiKey = ""; // Leave this empty, it will be handled by the environment
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;

        // Add click event listener to the generate button
        generateBtn.addEventListener('click', generateImage);

        /**
         * Asynchronous function to fetch with exponential backoff retry logic.
         */
        async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Error Response:", errorData);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorData.error?.message || response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return fetchWithRetry(url, options, retries - 1, delay * 2); 
                } else {
                    console.error("Max retries reached. Error:", error);
                    throw error;
                }
            }
        }
        
        /**
         * Main function to generate the image.
         */
        async function generateImage() {
            const userPrompt = promptInput.value.trim();

            if (!userPrompt) {
                showError("Please enter a prompt to generate a sticker!");
                return;
            }
            
            setLoading(true);
            hideError();
            downloadBtn.classList.add('hidden'); 

            // Updated prompt to remove the white background and get a die-cut style
            const fullPrompt = `A cutecore digital sticker of Hello Kitty ${userPrompt}, die-cut, clean edges, adorable, pink aesthetic, simple vector art, high quality, transparent background, japanese kawaii style.`;

            const payload = {
                instances: [
                    { prompt: fullPrompt }
                ],
                parameters: {
                    sampleCount: 1
                }
            };

            try {
                const result = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const base64Data = result.predictions[0].bytesBase64Encoded;
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    
                    stickerImage.src = imageUrl; 
                    
                    downloadBtn.href = imageUrl;
                    downloadBtn.classList.remove('hidden');

                } else {
                    console.error("Invalid API response structure:", result);
                    showError("Could not parse image data from the response. Please try again.");
                }

            } catch (error) {
                console.error('Error generating image:', error);
                showError(`An error occurred while generating the image: ${error.message}. Please try again.`);
            } finally {
                setLoading(false);
            }
        }

        /**
         * Helper function to update the UI to a loading or non-loading state.
         */
        function setLoading(isLoading) {
            if (isLoading) {
                generateBtn.disabled = true;
                loadingSpinner.classList.remove('hidden');
                generateBtnText.textContent = 'Generating...';
                // Reset to a loading placeholder, now with the new font
                stickerImage.src = "https://placehold.co/512x512/fdf2f8/ec4899?text=Loading...&font=baloo-2";
                downloadBtn.classList.add('hidden'); 
            } else {
                generateBtn.disabled = false;
                loadingSpinner.classList.add('hidden');
                // Restore button text
                generateBtnText.textContent = 'Bibidi Babidi Boo!';
            }
        }

        /**
         * Helper function to show an error message to the user.
         */
        function showError(message) {
            errorBox.textContent = message;
            errorBox.classList.remove('hidden');
            downloadBtn.classList.add('hidden'); 
            // Also reset loading state on error
            setLoading(false); 
        }

        /**
         * Helper function to hide the error message box.
         */
        function hideError() {
            errorBox.classList.add('hidden');
        }

    </script>
</body>
</html>
